# Apache Kafka
 # **Основы**
**Kafka** - это технология выступающая в роли распределенного брокера сообщений. Принимает какой-то поток данных от prodecer-ов, сохраняет в зависимости от типа данных их по "ящикам", потом приходят consumer-ы и из нужных им "ящиков" забирают данные. Open-source

![[../Files/Pasted image 20220928215714.png]]

![[../Files/Pasted image 20220928215720.png]]

Используется для
-   платформ с высокой производительностью
- стриминговой аналитики
- интеграция с различными данными из разных источников
-  и также в misson-critical приложениях

## **Свойства**
- распределенность
- отказоустойчивость, высокая производительность
- высокая доступность
- надежность и согласовонность данных
- горизонтальное масштабирование
- интегрируемость

## **Основные сущности Kafka**
1. Broker - прием сообщений, хранение сообщений, выдача сообщений. Они могут общаться между собой, объединяясь в кафка кластер. Масштабирование, репликация
2. Zookeeper - координатор. Хранит состояние кластера, конфигурацию, адресную книгу (data). - Kafka Controller - обеспечивает консистентность
3. Message (record) key_ - ключ (опциональный) используется для распределения сообщений по кластеру _Value_ - массив байт _Timestamp_ - время сообщений. Парсится или выставляется автоматически. _Headers -_ набор key-value пар с пользовательскими атрибутами сообщения
4.  Topic/Partition - стрим данных, выступающих как контейнер для данных. Данные обрабатываются по FIFO методу. - События из топика не исчезают при чтении консюмером, что обеспечивает нам широковещательный режим. - Чтобы распараллелить нагрузку в топиках есть партиции - такой подход ускоряет чтение/запись данных. выходят из партиций тоже по методу FIFO.
	1. **Где хранятся данные топика**? В log-файлах, для каждой партиции выделяется отдельная папка. В партиции лежат три файла - .log, .index, .timeindex
	2. **Log** - имеет в себе сообщения, данные в формате: Offset, Position, Timestamp, Message **Index** - мапинг оффсета на позицию. Формат: Offset, Position **Timeindex** - мапинг таймстемпа на оффсет. Нужно если хотим прочитать сообщение со вторника, к примеру, указываем этот таймстемп и для него будет выдан оффсет на чтение. Формат: Timestamp, Offset
	3. **Если появляется больше данных**, то в партиции появляются сегменты (еще по 3 файла на сегмент). Последний сегмент - последний Имя файла - start offset Ограничение на сегмент 1 ГБ.
	4. **Как удалить данные из топика**? Операции для удаления в кафке нет! Но поддерживается автоматическое удаление данных по TTL (time-to-live) - Удаляются целиком сегменты партиций (не отдельных сообщений) - segment timestamp exired -> to delete
5. Producer
6. Consumer
    


