# Allocator
## Linear allocator
Самый простой вид аллокаторов, идея состоит в том, чтобы сохранить указатель на начало блока памяти, а также смещение. В этом аллокаторе фрагментация сведена к минимуму, так как блоки выделяются последовательно.

Пример:
1. Доступно 14 байт, сначала выделяем 4 байта
2. Потом 8 байт
3. Остается 2 байта
4. Если нужно выделить 1 байт без выравнивания, то выделяем
5. Либо же выделяем 1 байт и еще 1 байт забираем для выравнивания - это обеспечивается минимальную фрагментацию
![[../Excalidraw/linearalloc.gif]]

Ну и во вторых, для избегания фрагментации, аллокатор не поддерживает выборочное освобождение блоков. Имея указатель на начало, мы не сможем освободить 4 байта, но можем освободить всю выделенную память целиком.

![[../Excalidraw/lineardealloc.gif]]

## Pool allocator
Идея блочного аллокатора заключается в том, что он разделяет большой участок памяти на более мелкие одинакового размера. Когда поступает запрос на выделение, но возвращает он из блоков, когда блок освобождается, он возвращается в pool свободных блоков. Таким образом, распределение работает очень быстро, а фрагментация все еще очень мала.

Пример:
1. Выделяем 2 байта
2. Выделяем 4 байта
3. Освобождаем 2 байта
4. Может возникнуть ситуации, чтобы мы попытаемся освободить не наш кусок памяти, тогда в пуле будет чужой адрес, а это UB, для этого нужно хранить позиции `start, end`
5. Либо может возникнуть ситуация, когда мы освобождаем блок, но адрес не равен началу блока. В таком случае нужно хранить адреса каждого блока
![[../Excalidraw/poolalloc.gif]]

## Stack allocator
Модернизированная версия линейного аллокатора которая позволяет управлять памятью, как стеком. Сохраняем указатель на начало блока и смещение, а также можем освободить последний выделенный кусок. Помимо этого, во время выделения сохраняем заголовок - количество  выделенной памяти, пользователю будет отдан указатель на адрес идущий после заголовка. Для удаления куска памяти, сначала отступаем от начала, чтобы узнать размер памяти, после освобождаем размер+header

![[../Excalidraw/stackalloc.gif]]
