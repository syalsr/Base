# Протокол IP
Передача данных без гарантии доставки, отправляются данные без установки соединения, т.е. может дойти, может не дойти.

Задачи IP:
1. Объединение сетей 
2. Маршрутизация 
3. Качество обслуживания

# Формат заголовка
![[ipprot.excalidraw]]
1. Номер версии - IPv4 и IPv6
2. Длина заголовка - длина обязательной части и опций
3. Тип сервиса - 2  бита используются для того, чтобы знать произошла ли [[Протокол TCP#Затопление и перегрузка|перегрузка]] - 00 нет, 11 - да 
4. Общая длина – длина пакета, включая заголовок и данные. Измеряется в байтах. Максимальное значение – 65535 байт На практике длина выбирается с учетом размера кадра канального уровня -  1500 байт для Ethernet
5. Время жизни (TTL, Time To Live) – максимальное время, в течение которого пакет может перемещаться по сети Введено для предотвращения «бесконечного» продвижения пакетов. Сейчас это уже не время, а счетчик(количество hop) который уменьшается каждый раз, когда пакет проходит через маршрутизатор
6. Тип протокола - Предназначено для реализации функции мультиплексирования/ демультиплексирования Код протокола, данные которого передаются:
	1. TCP – 6
	2. UDP – 17
	3. ICMP – 1
7. Опции
	1. Записать маршрут
	2. Маршрут отправителя
		1. Жесткая маршрутизация
		2. Свободная маршрутизация
	3. Временные метки
8. Выравнивание - Опции могут иметь разный размер. Длина заголовка IP-пакета должна быть кратна 32 битам, для выравнивания до 32 бит поле опций дополняется нулями

# IP-адреса
IP-адреса - глобальные адреса, применяются для идентификации компьютеров в составной сети. Разница между IPv4 и IPv6 в длине адреса - 4 и 16 байт/32 и 128 бит.

| 11010101 | 10110100 | 11000001 | 00000011 |
|:--------:|:--------:|:--------:|:--------:|
|   213.   |   180.   |   193.   |    3     |

[[Сетевой уровень]] работает не с отдельными адресами, а с подсетями - это множество компьютеров у которых старшая часть IP-адреса одинаковая:
1. 213.180.193.1
2. 213.180.193.2 
3. 213.180.193.3 
4. … 
5. 213.180.193.254

Соответственно, IP-адрес состоит из двух частей:
1. Номер подсети - старшие биты
2. Номер хоста(компьютера в сети) - младшие биты
3. IP-адрес - 213.180.193.1, номер подсети - 213.180.193.0, номер хоста - 1(0.0.0.1)

Для определения, где в IP-адресе находится номер подсети, используется маска подсети, он тоже состоит из 4 байт, в месте где маска содержит номер сети стоят единицы, в остальных нули, для вычисления используется логическое И:

|   IP    |   213.   |   180.   |   193.   |    3     |
|:-------:|:--------:|:--------:|:--------:|:--------:|
|   IP    | 11010101 | 10110100 | 11000001 | 00000011 |
|  Маска  | 11111111 | 11111111 | 11111111 | 00000000 |
|  Маска  |   255.   |   255.   |   255.   |    0     |
| Подсеть | 11010101 | 10110100 | 11000001 | 00000000 |
| Подсеть |   213.   |   180.   |   193.   |    0     |

Либо существует такая запись адрес - 213.180.193.3/24 - первые 24 бита - подсеть, остальные хост

# IPv4
В IPv4 существует 3 типа адресов:
1. Индивидуальный - данные получает один компьютер
2. Групповой - данные получают несколько компьютеров
3. Широковещательный - данные получают все компьютеры, в таких адресах на месте номера хоста стоят все единицы. 
	1. Направленное широковещание - пакет отправляется из другой сети в нашу, IP-адрес - 213.180.193.3/24, широковещательный адрес - 213.180.193.255
	2. Ограниченное широковещание - пакет отправляет в рамках одной сети, широковещательный адрес состоит из единиц - 255.255.255.255

В IP широковещательные пакеты передаются только внутри подсети(ограниченное широковещание).

Т.к. все IP-адрес должны быть уникальны, то всего с помощью 4 байт, можно создать $2^{32}$, IPv6 был создан для того, что увеличить его количество

# Специальные IP-адреса
1. В номере хоста нельзя использовать только битовые 0 или 1 
2. Битовые 0 в номере хоста: Адрес подсети: 213.180.193.0 
3. Битовые 1 в номере хоста: Широковещательный адрес: 213.180.193.255 
4. Договоренность (не обязательная): Хост с номером 1 – маршрутизатор по умолчанию (шлюз): 213.180.193.1
5. 0.0.0.0 – текущий хост (подсеть)
6. 255.255.255.255 – все хосты в текущей подсети (ограниченный широковещательный адрес)
7. 127.0.0.0/8 – обратная петля (loopback) 
	1. Сеть для тестирования 
	2. Данные не передаются в сеть, а приходят обратно 
	3. 127.0.0.1 – localhost (текущий компьютер)
8. 169.254.0.0/16 – Link-local адреса 
	1. Назначаются ОС хоста автоматически, если недоступна другая конфигурация IP
	2.  Могут использоваться в пределах подсети

